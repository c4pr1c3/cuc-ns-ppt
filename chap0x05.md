---
title: "ç½‘ç»œå®‰å…¨"
author: é»„ç®
output: revealjs::revealjs_presentation
---

# ç¬¬äº”ç«  ç½‘ç»œæ‰«æ

---

## æ¸©æ•…

* è®¿é—®æ§åˆ¶æ˜¯ï¼ˆæ“ä½œï¼‰ç³»ç»Ÿå®‰å…¨çš„åŸºç¡€
* å±€åŸŸç½‘çš„å®‰å…¨ç®¡ç†æ˜¯ç½‘ç»œå®‰å…¨çš„ **åŸºç¡€**
    * ä»»ä½•ç½‘ç»œå±‚åŠ å¯†æ•°æ®åœ¨ä¸€ä¸ª **ä¸å®‰å…¨** çš„å±€åŸŸç½‘ä¸­éƒ½æœ‰å¯èƒ½è¢«å—…æ¢
    * æ”»å‡»è€…ä¸€æ—¦æ¸—é€è¿›å…¥å†…éƒ¨ç½‘ç»œï¼Œåæœä¸å ªè®¾æƒ³
    * å†…ç½‘å®‰å…¨å…ˆä»ç®¡å¥½ARPåè®®å¼€å§‹
* ç½‘ç»œç›‘å¬æ˜¯ **è¢«åŠ¨** åˆ†æç½‘ç»œå®‰å…¨çš„é‡è¦æ‰‹æ®µ

---

## çŸ¥æ–°

* ç½‘ç»œæ‰«ææ˜¯ä¸»åŠ¨åˆ†æç½‘ç»œå®‰å…¨çš„é‡è¦æ‰‹æ®µ
    * å¯¹äºé»‘å®¢æ¥è¯´
        * ç½‘ç»œæ‰«ææ˜¯ç½‘ç»œå…¥ä¾µçš„åºæ›²
        * ç½‘ç»œæ‰«ææ˜¯ä¿¡æ¯æ”¶é›†çš„æ‰‹æ®µä¹‹ä¸€
* å¯¹äºç½‘ç»œç®¡ç†å‘˜æ¥è¯´
    * ç½‘ç»œæ‰«ææ˜¯ç½‘ç»œå®‰å…¨é˜²å¾¡çš„è‡ªæˆ‘æ£€æµ‹æ‰‹æ®µ

# ç½‘ç»œæ‰«æä¸ä¿¡æ¯æ”¶é›†

---

## ä¿¡æ¯æ”¶é›†

* çŸ¥å·±çŸ¥å½¼ï¼Œç™¾æˆ˜ä¸æ®†

> è¯­å‡ºã€Šå­™å­Â·è°‹æ”»ã€‹

> çŸ¥å·±çŸ¥å½¼ï¼Œç™¾æˆ˜ä¸æ®†ï¼›ä¸çŸ¥å½¼è€ŒçŸ¥å·±ï¼Œä¸€èƒœä¸€è´Ÿï¼›ä¸çŸ¥å½¼ï¼Œä¸çŸ¥å·±ï¼Œæ¯æˆ˜å¿…æ®†ã€‚

---

## ä¿¡æ¯æ”¶é›†çš„ç›®æ ‡å¯¹è±¡

* ç›®æ ‡ä¸»æœº
* ç›®æ ‡ç½‘ç»œ
* ç›®æ ‡åº”ç”¨/æœåŠ¡
* ç›®æ ‡äºº

---

## ä¿¡æ¯æ”¶é›†ä¹‹ç½‘ç»œæ‰«æ

* ç½‘ç»œæ‰«ææ˜¯å®ç°ä¿¡æ¯æ”¶é›†ç›®çš„ **æ‰‹æ®µä¹‹ä¸€**
* é‡ç‚¹å…³æ³¨
    * ç›®æ ‡ä¸»æœº
    * ç½‘ç»œæ‹“æ‰‘
    * ç›®æ ‡åº”ç”¨/æœåŠ¡

---

### ç›®æ ‡ä¸»æœº

* åœ¨çº¿çŠ¶æ€
    * ç«¯å£å¼€æ”¾æƒ…å†µ
    * ç½‘ç»œæœåŠ¡è¯¦ç»†ä¿¡æ¯
* å¤–ç½‘è¾¹ç•Œå…¥å£ä¸»æœº
* å†…ç½‘ç›®æ ‡ä¸»æœº

---

### ç½‘ç»œæ‹“æ‰‘

* ç½‘ç»œè¾¹ç•Œï¼šç½‘å…³
* å­ç½‘åˆ’åˆ† / VLAN / Windows åŸŸæ§æœåŠ¡å™¨ 
* ç½‘ç»œåŸºç¡€è®¾æ–½ï¼šDNSã€DHCPã€NTPã€Captive Portalã€Radius Serverã€LDAP
* ç½‘ç»œå®‰å…¨åŸºç¡€è®¾æ–½ï¼šé˜²ç«å¢™ã€å…¥ä¾µæ£€æµ‹ã€å…¥ä¾µé˜²æŠ¤ã€èœœç½å’Œèœœç½‘ç­‰

---

### ç›®æ ‡åº”ç”¨/æœåŠ¡

* ç‰ˆæœ¬ä¿¡æ¯
* æ˜¯å¦å­˜åœ¨æ¼æ´


---

## ä¿¡æ¯æ”¶é›†ä¹‹è¸©ç‚¹

* ç›´æ¥è®¿é—®
    * ç›®æ ‡ä¸»æœº
    * ç›®æ ‡ç½‘ç»œ
    * ç›®æ ‡åº”ç”¨/æœåŠ¡
* é»‘ç›’æµ‹è¯•
    * ä½¿ç”¨ç‰¹å®šå®¢æˆ·ç«¯è¿æ¥æŒ‡å®šç«¯å£/åº”ç”¨/æœåŠ¡
        * æµè§ˆå™¨ / FTP /telnet
    * ä½¿ç”¨ç‰¹å®šå¸å·å’Œå£ä»¤å°è¯•ç™»å½•
    * æ¨¡ä»¿äº¤äº’

---

## ä¿¡æ¯æ”¶é›†ä¹‹è¸©ç‚¹

* ç™½ç›’åˆ†æ
    * é€šè¿‡ banner æŠ“å–å’Œåº”ç”¨æŒ‡çº¹è¯†åˆ«ç¡®å®šäº†å¼€æºç»„ä»¶ä¿¡æ¯ä¹‹å

---

## ä¿¡æ¯æ”¶é›†ä¹‹ç¤¾ä¼šå·¥ç¨‹å­¦

* ç›®æ ‡äºº
    * ç¤¾äº¤ç½‘ç»œåº”ç”¨ä¿¡æ¯ï¼šå¾®åš / SNS / blog â€¦
* Google Hacking
    * site: / filetype: / inurl:
    * GHDB: Google Hacking Database
* é’“é±¼
    * ç”µå­é‚®ä»¶ / å³æ—¶é€šä¿¡ / ç”µè¯ â€¦

---

### ä¸€å¼ å›¾ç‰‡ä¸­éšè—çš„ä¿¡æ¯

![](images/chap0x05/photo-exif-0.png)

---

### ä¸€å¼ å›¾ç‰‡ä¸­éšè—çš„ä¿¡æ¯

![](images/chap0x05/photo-exif-1.png)

---

### ä¸€å¼ å›¾ç‰‡ä¸­éšè—çš„ä¿¡æ¯

![](images/chap0x05/photo-exif-2.png)

---

### ä¸€å¼ å›¾ç‰‡ä¸­éšè—çš„ä¿¡æ¯

[![](images/chap0x05/mcafee-leader-gps-leakage.png)](http://tech.sina.com.cn/digi/dc/2012-12-05/13487859580.shtml)

---

## ä¿¡æ¯æ”¶é›†çš„è‡ªåŠ¨åŒ–

![](images/chap0x05/maltego-1.png)

---

## ä¿¡æ¯æ”¶é›†çš„è‡ªåŠ¨åŒ–

![](images/chap0x05/maltego-2.png)

---

## ä¿¡æ¯æ”¶é›†çš„è‡ªåŠ¨åŒ–

![](images/chap0x05/maltego-3.png)

# ç½‘ç»œæ‰«æåŸç†

---

* ç½‘ç»œæ‰«æçš„åŸºæœ¬æ€æƒ³
* ç½‘ç»œæ‰«æçš„åŸºæœ¬åŸç†
* ç½‘ç»œæ‰«æçš„ä¸»è¦å®ç°æŠ€æœ¯

---

## åŸºæœ¬æ€æƒ³

![](images/chap0x05/scan-seq.png)

---

### æŠ¥æ–‡å‘é€ä¸æ¥æ”¶

[![åŸºäº scapy åŠ¨æ‰‹å®è·µä¸€æ¬¡â€œæ‰‹åŠ¨â€å‘é€ä¸æ¥æ”¶æŠ¥æ–‡](https://asciinema.org/a/pPklHDfK5vUquhbcMF70oOqbs.svg)](https://asciinema.org/a/pPklHDfK5vUquhbcMF70oOqbs)

---

### TCP/IP åè®®æ ˆè§†è§’çœ‹ç½‘ç»œæ‰«æ {id="scan-by-layers"}

![](images/chap0x05/scan-by-layers.png)

---

### TCP/IP åè®®æ ˆè§†è§’çœ‹ç½‘ç»œæ‰«æ {id="scan-by-layers-flowgraph"}

[![](images/chap0x05/scapy-ping.png)](attach/chap0x05/scapy-ping.pcap)

> Wireshark å·¥å…·èœå•é‡Œ Statistics --> Flow Graph

---

### å›é¡¾ï¼šTCP åè®® {id="tcp-review"}

* Transmission Control Protocol
* TCPæ˜¯ä¸€ç§é¢å‘è¿æ¥çš„ï¼Œå¯é çš„ä¼ è¾“å±‚åè®®
* TCPå»ºç«‹è¿æ¥è¿‡ç¨‹ç§°ä¸ºä¸‰æ¬¡æ¡æ‰‹

---

![](images/chap0x05/tcp-hdr-format.png)

---

[![asciicast](https://asciinema.org/a/gs6z4NnrB1SrW13cxq67s9P8P.svg)](https://asciinema.org/a/gs6z4NnrB1SrW13cxq67s9P8P)

---

[![](images/chap0x05/curl-http.png)](attach/chap0x05/curl-http.pcap)

---

### å›é¡¾ï¼šUDP åè®® {id="udp-review"}

* User Datagram Protocol
* UDP æ˜¯ä¸€ç§æä¾›é¢å‘äº‹åŠ¡çš„ç®€å•ä¸å¯é ä¿¡æ¯ä¼ é€æœåŠ¡
    * æ— è¿æ¥åè®®ï¼šæºå’Œç›®çš„ç«¯åœ¨æ•°æ®ä¼ è¾“ä¹‹å‰ä¸å»ºç«‹è¿æ¥
        * æ”¶å‘åŒæ–¹å‡æ— éœ€ç»´æŠ¤è¿æ¥çŠ¶æ€ä¿¡æ¯
        * åº”ç”¨å±‚æŒ‰éœ€ç»´æŠ¤è¿æ¥çŠ¶æ€ä¿¡æ¯
    * å°½åŠ›è€Œä¸º
        * ç›¸æ¯”è¾ƒäº TCP åè®®çš„æ“ä½œç³»ç»Ÿåè®®æ ˆå®ç°è€Œè¨€

---

![](images/chap0x05/udp-hdr-format.png)

---

### å›é¡¾ï¼šICMP åè®® {id="icmp-review"}

* Internet Control Message Protocol
* ç”¨é€”
    * ç½‘å…³æˆ–è€…ç›®æ ‡æœºå™¨åˆ©ç”¨ ICMP ä¸æºé€šè®¯
    * å½“å‡ºç°é—®é¢˜æ—¶ï¼Œæä¾›åé¦ˆä¿¡æ¯ç”¨äºæŠ¥å‘Šé”™è¯¯
* ç‰¹ç‚¹
    * å…¶æ§åˆ¶èƒ½åŠ›å¹¶ä¸ç”¨äºä¿è¯ä¼ è¾“çš„å¯é æ€§
    * å®ƒæœ¬èº«ä¹Ÿä¸æ˜¯å¯é ä¼ è¾“çš„
    * å¹¶ä¸ç”¨æ¥åæ˜  ICMP æŠ¥æ–‡çš„ä¼ è¾“æƒ…å†µ

---

![](images/chap0x05/icmp-format.png)

---

## åè®®æ ‡å‡†å’Œï¼ˆæ“ä½œç³»ç»Ÿï¼‰åè®®æ ˆçš„å…³ç³»

* åè®®æ ‡å‡†ï¼ˆå£°æ˜ï¼‰
    * ä¸¥æ ¼ç»Ÿä¸€å’Œè§„èŒƒæ ‡å‡†
        * RFC 793 TRANSMISSION CONTROL PROTOCOL
        * RFC 768 User Datagram Protocol
        * RFC 791 INTERNET PROTOCOL
        * RFC 792 Internet Control Message Protocol
* åè®®æ ˆï¼ˆå®ç°ï¼‰
    * ä¸¥æ ¼éµå¾ªæ ‡å‡†å®ç°
    * æ ‡å‡†æœªå°½ä¹‹å¤„çš„å®ç°ä¼šç•¥æœ‰ **å·®å¼‚**

---

## æ‰«æçŸ¥è¯†åº“æ„å»ºä¸è§„åˆ™åŒ¹é…

![æ¯ä¸€å±‚éƒ½å¯ä»¥æ„å»ºç‹¬ç«‹çŸ¥è¯†åº“](images/chap0x05/scan-kb-by-layers.png)

---

### æ‰«æçŸ¥è¯†åº“æ„å»ºä¸¾ä¾‹ â€”â€” [IANA æ³¨å†Œç«¯å£å·](https://tools.ietf.org/html/rfc4340#section-19.9)

* ä¼ è¾“å±‚æŠ¥æ–‡å¤´éƒ¨å­—æ®µç‰¹å¾
* å…¬ç”¨ç«¯å£
    * 0 åˆ° 1023
* æ³¨å†Œç«¯å£
    * 1024 åˆ°49151
* åŠ¨æ€çš„æˆ–ç§æœ‰ç«¯å£
    * 49152 åˆ° 65535

---

* `/etc/services`
* `/usr/share/nmap/nmap-services` ï¼ˆå®‰è£… `nmap` ä¹‹åï¼‰

---

### Service Name and Transport Protocol Port Number Registry

[![](images/chap0x05/etc.services.png)](https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml)

---

## ç«¯å£çŠ¶æ€ â€”â€” çŸ¥è¯†åº“æ„å»ºçš„åŸºç¡€ {id="port-status"}

* å¼€æ”¾ âœ…
    * åº”ç”¨/æœåŠ¡ç›‘å¬è¯¥ç«¯å£
    * **æœ‰æ¡ä»¶æœ‰è§„åˆ™** åœ°å“åº”è¯·æ±‚æ•°æ®æŠ¥æ–‡
* å…³é—­ â›”
    * æ— åº”ç”¨/æœåŠ¡ç›‘å¬è¯¥ç«¯å£
    * **æœ‰æ¡ä»¶æœ‰è§„åˆ™** åœ°å“åº”æˆ–å¿½ç•¥è¯·æ±‚æ•°æ®æŠ¥æ–‡
    * æ“ä½œç³»ç»Ÿä¼šé’ˆå¯¹SYNè¯·æ±‚æŠ¥æ–‡å›åº”RSTæŠ¥æ–‡
* è¢«è¿‡æ»¤ âš ï¸
    * æŠ¥æ–‡è¿‡æ»¤ç¨‹åºç›‘å¬è¯¥ç«¯å£
    * **æœ‰æ¡ä»¶æœ‰è§„åˆ™** åœ°å“åº”æˆ–å¿½ç•¥è¯·æ±‚æ•°æ®æŠ¥æ–‡
        * æŠ¥æ–‡è¿‡æ»¤ç¨‹åºå¯èƒ½ä¼šè¿”å›æŠ¥æ–‡æ‹’ç»æ¶ˆæ¯

---

## ä¸»æœºçŠ¶æ€

* å¯è¾¾ï¼ˆåœ¨çº¿ï¼‰ ğŸ“¶
    * å¯¹è‡³å°‘ä¸€ç§ç±»å‹çš„è¯·æ±‚æ•°æ®åŒ…æœ‰å“åº”ï¼ˆå……è¦æ¡ä»¶ï¼‰
        * æœ‰å¼€æ”¾ç«¯å£ï¼ˆå……åˆ†éå¿…è¦æ¡ä»¶ï¼‰
* ä¸å¯è¾¾ï¼ˆç¦»çº¿ï¼‰ ğŸ“´ 
    * å¯¹ä»»ä½•ç±»å‹çš„è¯·æ±‚æ•°æ®åŒ…å‡æ— å“åº”ï¼ˆå……åˆ†æ¡ä»¶ï¼‰
        * æ— å¼€æ”¾ç«¯å£ï¼ˆå¿…è¦éå……åˆ†æ¡ä»¶ï¼‰
            * ä¾‹å¦‚æ™®é€šPCæœºï¼Œåœ¨çº¿æ—¶ä½†æ— å¼€æ”¾ç«¯å£
    * åœ¨çº¿ä¸»æœºåœ¨é˜²ç«å¢™çš„ä¿æŠ¤ä¸‹ä¹Ÿå¯èƒ½æ˜¯ä¸å¯è¾¾çŠ¶æ€

---

â„¹ï¸  æ³¨æ„äº‹é¡¹

> ç«¯å£çŠ¶æ€æ˜¯ä¼ è¾“å±‚çš„æ¦‚å¿µï¼Œä¸è¦å’Œç½‘ç»œå±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç‰©ç†å±‚å¯è¾¾æ··æ·†

---

## ä¸»æœºçŠ¶æ€è¯¦ç»†ä¿¡æ¯

* æ“ä½œç³»ç»Ÿä¿¡æ¯
    * å‘è¡Œç‰ˆæœ¬ã€è¯¦ç»†ç‰ˆæœ¬å·ã€è¯­è¨€ç­‰
* ç«¯å£/åº”ç”¨/æœåŠ¡çŠ¶æ€ä¿¡æ¯
    * ç«¯å£çŠ¶æ€
    * åº”ç”¨ç¨‹åºç‰ˆæœ¬
* è¿œç¨‹è·å–ä¸»æœºçŠ¶æ€è¯¦ç»†ä¿¡æ¯çš„åŸºç¡€
    * ä¸»æœºæ‰«æ
    * TCP/IP åè®®æ ˆå®ç°çŸ¥è¯†åº“
        * ä¸åŒæ“ä½œç³»ç»Ÿ/åº”ç”¨ç¨‹åºçš„å·®å¼‚

# ä¸»æœºæ‰«ææŠ€æœ¯

---

## å¯è¾¾çŠ¶æ€æ£€æµ‹

* å±€åŸŸç½‘
    * ARP æ‰«æ
* å¹¿åŸŸç½‘
    * ICMP Echo æ‰«æ
    * ICMP Sweep æ‰«æ
    * ICMP Broadcast æ‰«æ
    * ICMP Non-Echo æ‰«æ

---

### å±€åŸŸç½‘ ARP æ‰«æ {id="arping"}

```python
#! /usr/bin/env python
# arping: arpings a network

import sys
from scapy.all import srp, Ether, ARP, conf


if len(sys.argv) != 2:
    print("Usage: arping <net>\n  eg: arping 192.168.56.1/24")
    sys.exit(1)

conf.verb = 0

pkt = Ether(dst="ff:ff:ff:ff:ff:ff")/ARP(pdst=sys.argv[1])
ans, unans = srp(pkt, timeout=2)

for snd, rcv in ans:
    print("{} {}".format(rcv.src, rcv.psrc))
```

---

![ARP Ping è¯·æ±‚å“åº”è¿‡ç¨‹ç¤ºæ„å›¾](images/chap0x05/arping-flowgraph.png)

---

### ICMP echo æ‰«æ

* å®ç°åŸç†
    * pingçš„å®ç°æœºåˆ¶
* ä¼˜ç‚¹
    * ç®€å•ï¼Œç³»ç»Ÿæ”¯æŒ
* ç¼ºç‚¹
    * å¾ˆå®¹æ˜“è¢«é˜²ç«å¢™é™åˆ¶

---

### ICMP Sweep æ‰«æ

```python
#!/usr/bin/env python

import sys
import threading
import ipaddress
from scapy.all import ICMP, IP, sr1
from queue import Queue

if len(sys.argv) < 2:
    print("Usage: icmping <host> [icmp_type] [icmp_code]\n")
    print("eg: icmping 192.168.56.0/24")
    print("eg: icmping 192.168.56.0/24 13 0")
    print("eg: icmping 192.168.56.0/24 15 0")
    print("eg: icmping 192.168.56.0/24 17 0")
    sys.exit(1)

network = sys.argv[1]
if len(sys.argv) < 3:
    icmp_type = 8
else:
    icmp_type = int(sys.argv[2])

if len(sys.argv) < 4:
    icmp_code = 0
else:
    icmp_code = int(sys.argv[3])

max_threads = 100
ip_net = ipaddress.ip_network(network)
all_hosts = list(ip_net.hosts())
live_count = 0

print('Sweeping Network with ICMP: {} type={}/code={}'.format(network, icmp_type, icmp_code))


def pingsweep(ip):
    host = str(all_hosts[ip])
    resp = sr1(
        IP(dst=str(host))/ICMP(type=icmp_type, code=icmp_code),
        timeout=2,
        verbose=0,
    )

    if resp is None:
        # print(f"{host} is down or not responding.")
        return 0
    elif (
        int(resp.getlayer(ICMP).type) == 3 and int(resp.getlayer(ICMP).code) in [1, 2, 3, 9, 10, 13]
    ):
        # print(f"{host} is blocking ICMP.")
        return 0
    else:
        print(f"{host} is responding.")
        return 1


def threader():
    while True:
        worker = q.get()
        pingsweep(worker)
        q.task_done()


q = Queue()

for x in range(max_threads):
    t = threading.Thread(target=threader)
    t.daemon = True
    t.start()

for worker in range(len(all_hosts)):
    q.put(worker)

q.join()
```

---

![ICMP Sweep æ‰«æ](images/chap0x05/icmp-sweep-scan.png)

---

### ICMP Broadcast æ‰«æ

* å®ç°åŸç†
    * å°†ICMPè¯·æ±‚åŒ…çš„ç›®æ ‡åœ°å€è®¾ä¸ºå¹¿æ’­åœ°å€æˆ–ç½‘ç»œåœ°å€ï¼Œåˆ™å¯ä»¥æ¢æµ‹å¹¿æ’­åŸŸæˆ–æ•´ä¸ªç½‘ç»œèŒƒå›´å†…çš„ä¸»æœº
* ç¼ºç‚¹
    * åªé€‚åˆäºUNIX/Linuxç³»ç»Ÿï¼ŒWindows ä¼šå¿½ç•¥è¿™ç§è¯·æ±‚åŒ…ï¼›
    * è¿™ç§æ‰«ææ–¹å¼å®¹æ˜“å¼•èµ·å¹¿æ’­é£æš´

```bash
ping -b 192.168.0.255
```
---

[![ICMP Broadcast æ‰«æ](images/chap0x05/icmp-broadcast-scan.png)](attach/chap0x05/icmp-broadcast-scan.pcap)
---

### Non-Echo ICMP æ‰«æ

ä¸€äº›å…¶å®ƒ ICMP ç±»å‹åŒ…ä¹Ÿå¯ä»¥ç”¨äºå¯¹ä¸»æœºæˆ–ç½‘ç»œè®¾å¤‡çš„æ¢æµ‹ï¼Œå¦‚ï¼š

* Stamp Request(Type 13) / Reply(Type 14)
* Information Request(Type 15) / Reply(Type 16)
* Address Mask Request (Type 17) / Reply(Type 18)

---

## å¯è¾¾çŠ¶æ€æ£€æµ‹é«˜çº§æŠ€æœ¯ {id="reachable-test-1"}

é˜²ç«å¢™å’Œç½‘ç»œè¿‡æ»¤è®¾å¤‡çš„å­˜åœ¨ï¼Œå¸¸å¸¸å¯¼è‡´ä¼ ç»Ÿçš„æ¢æµ‹æ‰‹æ®µå˜å¾—æ— æ•ˆï¼Œä¸ºäº†çªç ´è¿™ç§é™åˆ¶

* å¼‚å¸¸çš„ IP åŒ…å¤´
* åœ¨ IP å¤´ä¸­è®¾ç½®æ— æ•ˆçš„å­—æ®µå€¼
* é”™è¯¯çš„æ•°æ®åˆ†ç‰‡
* é€šè¿‡è¶…é•¿åŒ…æ¢æµ‹å†…éƒ¨è·¯ç”±å™¨
* åå‘æ˜ å°„æ¢æµ‹

---

### å¼‚å¸¸çš„IPåŒ…å¤´

* å‘ç›®æ ‡ä¸»æœºå‘é€åŒ…å¤´é”™è¯¯çš„ IP åŒ…ï¼Œç›®æ ‡ä¸»æœºæˆ–è¿‡æ»¤è®¾å¤‡å¯èƒ½ä¼šåé¦ˆ `ICMP Parameter Problem Error` ä¿¡æ¯
    * å¸¸è§çš„ä¼ªé€ é”™è¯¯å­—æ®µä¸º `Header Length Field` å’Œ `IP Options Field`

---

### åœ¨ IP å¤´ä¸­è®¾ç½®æ— æ•ˆçš„å­—æ®µå€¼

* å‘ç›®æ ‡ä¸»æœºå‘é€çš„IPåŒ…ä¸­å¡«å……é”™è¯¯çš„å­—æ®µå€¼ï¼Œç›®æ ‡ä¸»æœºæˆ–è¿‡æ»¤è®¾å¤‡ä¼šåé¦ˆ `ICMP Destination Unreachable` ä¿¡æ¯

---

### é”™è¯¯çš„æ•°æ®åˆ†ç‰‡

* å½“ç›®æ ‡ä¸»æœºæ¥æ”¶åˆ°é”™è¯¯çš„æ•°æ®åˆ†ç‰‡,å¹¶ä¸”åœ¨è§„å®šçš„æ—¶é—´é—´éš”å†…å¾—ä¸åˆ°æ›´æ­£æ—¶ï¼Œå°†ä¸¢å¼ƒè¿™äº›é”™è¯¯æ•°æ®åŒ…ï¼Œå¹¶å‘å‘é€ä¸»æœºåé¦ˆ `ICMP Fragment Reassembly Time Exceeded` é”™è¯¯æŠ¥æ–‡

---

### é€šè¿‡è¶…é•¿åŒ…æ¢æµ‹å†…éƒ¨è·¯ç”±å™¨

* è‹¥æ„é€ çš„æ•°æ®åŒ…é•¿åº¦è¶…è¿‡ç›®æ ‡ç³»ç»Ÿæ‰€åœ¨è·¯ç”±å™¨çš„ `PMTU` ä¸”è®¾ç½®ç¦æ­¢åˆ†ç‰‡æ ‡å¿—, è¯¥è·¯ç”±å™¨ä¼šåé¦ˆ  `Fragmentation Needed and Donâ€™t Fragment Bit was Set` å·®é”™æŠ¥æ–‡ï¼Œä»è€Œè·å–ç›®æ ‡ç³»ç»Ÿçš„ç½‘ç»œæ‹“æ‰‘ç»“æ„

---

### åå‘æ˜ å°„æ¢æµ‹

* ç”¨å¤„
    * è¯¥æŠ€æœ¯ç”¨äºæ¢æµ‹è¢«è¿‡æ»¤è®¾å¤‡å’Œé˜²ç«å¢™ä¿æŠ¤çš„ç½‘ç»œå’Œä¸»æœº
* æ–¹æ³•
    * æ„é€ å¯èƒ½çš„å†…éƒ¨IPåœ°å€åˆ—è¡¨ï¼Œå¹¶å‘è¿™äº›åœ°å€å‘é€æ•°æ®åŒ…
    * å¯¹æ–¹è·¯ç”±å™¨è¿›è¡ŒIPè¯†åˆ«å¹¶è·¯ç”±
    * æ ¹æ®æ˜¯å¦è¿”å›é”™è¯¯æŠ¥æ–‡æ¥è¿›è¡Œæ¢æµ‹

# ä¸»æœºçŠ¶æ€è¯¦ç»†ä¿¡æ¯æ¢æµ‹æŠ€æœ¯

---

* å¼€æ”¾æ‰«æ
    * ä¼šäº§ç”Ÿå¤§é‡å®¡è®¡æ•°æ®ï¼Œå®¹æ˜“è¢«å¯¹æ–¹å‘ç°ï¼Œä½†å…¶å¯é æ€§é«˜
* éšè”½æ‰«æ
    * èƒ½æœ‰æ•ˆé¿å…å¯¹æ–¹å…¥ä¾µæ£€æµ‹ç³»ç»Ÿå’Œé˜²ç«å¢™çš„æ£€æµ‹ï¼Œä½†è¿™ç§æ‰«æä½¿ç”¨çš„æ•°æ®åŒ…åœ¨é€šè¿‡ç½‘ç»œæ—¶å®¹æ˜“è¢«ä¸¢å¼ƒä»è€Œäº§ç”Ÿé”™è¯¯çš„æ¢æµ‹ä¿¡æ¯
* åŠå¼€æ”¾æ‰«æ
    * éšè”½æ€§å’Œå¯é æ€§ä»‹äºå‰ä¸¤è€…ä¹‹é—´

---

## å¼€æ”¾æ‰«æ â€”â€” TCP Connect æ‰«æ {id="tcp-connect-scan-1"}

| åºå· | é€šä¿¡æ–¹å‘ | æµç¨‹ 1      | æµç¨‹ 2      | æµç¨‹ 3                  |
| --   | --       | --          | --          | --                      |
| 1    | C -> S   | SYN+Port(n) | SYN+Port(n) | SYN+Port(n)             |
| 2    | S -> C   | SYN/ACK     | RST         | æ— å“åº”/å…¶ä»–æ‹’ç»åé¦ˆæŠ¥æ–‡ |
| 3    | C -> S   | ACK         |             |                         |
| 4    | C -> S   | RST         |             |                         |
|      | çŠ¶æ€æ¨æ–­ | å¼€æ”¾ âœ…     | å…³é—­  â›”    | è¢«è¿‡æ»¤ âš ï¸                |

---

### TCP Connect æ‰«æ {id="tcp-connect-scan-2"}

* å®ç°åŸç†
    * connect()
    * å®ŒæˆTCPä¸‰æ¬¡æ¡æ‰‹
* ä¼˜ç‚¹
    * ç¨³å®šå¯é ï¼Œä¸éœ€è¦ç‰¹æ®Šçš„æƒé™
* ç¼ºç‚¹
    * æ‰«ææ–¹å¼ä¸éšè”½ï¼ŒæœåŠ¡å™¨æ—¥å¿—ä¼šè®°å½•ä¸‹å¤§é‡å¯†é›†çš„è¿æ¥å’Œé”™è¯¯è®°å½•ï¼Œå¹¶å®¹æ˜“è¢«é˜²ç«å¢™å‘ç°å’Œå±è”½

---

## å¼€æ”¾æ‰«æ â€”â€” UDP æ‰«æ {id="udp-scan-1"}

| åºå· | é€šä¿¡æ–¹å‘ | æµç¨‹ 1               | æµç¨‹ 2                        |
| --   | --       | --                   | --                            |
| 1    | C -> S   | UDP+Port(n)          | UDP+Port(n)                   |
| 2    | S -> C   | UDP+port(n) å“åº”æ•°æ® | æ— å“åº”/å…¶ä»–æ‹’ç»åé¦ˆæŠ¥æ–‡       |
|      | çŠ¶æ€æ¨æ–­ | å¼€æ”¾ âœ…              | å¼€æ”¾ âœ… / å…³é—­  â›” / è¢«è¿‡æ»¤ âš ï¸ |

---

### UDP æ‰«æ {id="udp-scan-2"}

* å®ç°åŸç†
    * å‘æŒ‡å®š UDP ç«¯å£å‘é€æ•°æ®
    * å¦‚æœã€Œè¯­è¨€ç›¸é€šã€ï¼Œåˆ™æœåŠ¡ç«¯ä¼šæ ¹æ®â€œè¯­è¨€å†…å®¹â€ï¼ˆUDP ä¸Šå±‚åº”ç”¨åè®®çº¦å®šï¼‰ã€Œå“åº”æ•°æ®ã€
    * å¦‚æœã€Œé¸¡åŒé¸­è®²ã€ï¼Œåˆ™ç›®æ ‡ç«¯å£å³ä½¿å¤„äºå¼€æ”¾çŠ¶æ€ä¹Ÿå¯èƒ½ä¼šè¡¨ç°å‡ºã€Œé™é»˜æ— å“åº”ã€è¡Œä¸º

---

## åŠå¼€æ”¾æ‰«æ â€”â€” TCP SYN æ‰«æ {id="tcp-syn-scan-1"}

| åºå· | é€šä¿¡æ–¹å‘ | æµç¨‹ 1      | æµç¨‹ 2      | æµç¨‹ 3                  |
| --   | --       | --          | --          | --                      |
| 1    | C -> S   | SYN+Port(n) | SYN+Port(n) | SYN+Port(n)             |
| 2    | S -> C   | SYN/ACK     | RST         | æ— å“åº”/å…¶ä»–æ‹’ç»åé¦ˆæŠ¥æ–‡ |
| 3    | C -> S   | RST         |             |                         |
|      | çŠ¶æ€æ¨æ–­ | å¼€æ”¾ âœ…     | å…³é—­  â›”    | è¢«è¿‡æ»¤ âš ï¸                |

---

## åŠå¼€æ”¾æ‰«æ â€”â€” TCP SYN æ‰«æ {id="tcp-syn-scan-2"}

* å®ç°åŸç†
    * ä»…å‘é€ SYN åŒ…
    * ä¸å»ºç«‹å®Œæ•´TCPè¿æ¥
    * åˆç§°ä¸ºåŠå¼€æ”¾/åŠè¿æ¥æ‰«æ
* ä¼˜ç‚¹
    * éšè”½æ€§è¾ƒå…¨è¿æ¥æ‰«æå¥½ï¼Œå¾ˆå¤šç³»ç»Ÿå¯¹è¿™ç§åŠæ‰«æå¾ˆå°‘è®°å½•
* ç¼ºç‚¹
    * éœ€è¦ **æ“ä½œç³»ç»Ÿç®¡ç†å‘˜æƒé™** æ„é€  SYN æŠ¥æ–‡
    * ç½‘ç»œé˜²æŠ¤è®¾å¤‡ä¼šæœ‰è®°å½•

---

## åŠå¼€æ”¾æ‰«æ â€”â€” TCP é—´æ¥æ‰«æ {id="tcp-proxy-scan-1"}

![TCP é—´æ¥æ‰«æ](images/chap0x05/tcp-proxy-scan.png)

---

## åŠå¼€æ”¾æ‰«æ â€”â€” TCP é—´æ¥æ‰«æ {id="tcp-proxy-scan-2"}

* å®ç°åŸç†
    * ä¼ªé€  **ç¬¬ä¸‰æ–¹æº IP**ï¼ˆ`è·³æ¿æœº IP`ï¼‰å‘èµ· SYN æ‰«æ
* ä¼˜ç‚¹
    * éšè”½æ€§å¥½
* ç¼ºç‚¹
    * å¯¹è·³æ¿ä¸»æœºçš„è¦æ±‚è¾ƒé«˜
    * å¹¿åŸŸç½‘ä¸­å—åˆ¶äºè·¯ç”±å™¨çš„åŒ…è¿‡æ»¤è§„åˆ™

---

## éšè”½æ‰«æ â€”â€” TCP FIN æ‰«æ {id="tcp-fin-scan-1"}

| åºå· | é€šä¿¡æ–¹å‘ | æµç¨‹ 1          | æµç¨‹ 2                         |
| --   | --       | --              | --                             |
| 1    | C -> S   | TCP FIN+Port(n) | TCP FIN+Port(n)                    |
| 2    | S -> C   | RST             | æ— å“åº”/å…¶ä»–æ‹’ç»åé¦ˆæŠ¥æ–‡        |
|      | çŠ¶æ€æ¨æ–­ | å…³é—­  â›”        | å¼€æ”¾ âœ… / å…³é—­  â›” / è¢«è¿‡æ»¤ âš ï¸  |

---

## éšè”½æ‰«æ â€”â€” TCP FIN æ‰«æ {id="tcp-fin-scan-2"}

* å®ç°åŸç†
    * ä»…å‘é€ FIN åŒ…
* ä¼˜ç‚¹
    * FIN æ•°æ®åŒ…èƒ½å¤Ÿé€šè¿‡åªç›‘æµ‹ SYN åŒ…çš„åŒ…è¿‡æ»¤å™¨
    * éšè”½æ€§è¾ƒ SYN æ‰«ææ›´é«˜
* ç¼ºç‚¹
    * è·Ÿ SYN æ‰«æç±»ä¼¼ï¼Œéœ€è¦è‡ªå·±æ„é€ æ•°æ®åŒ…ï¼Œè¦æ±‚ç”± **æ“ä½œç³»ç»Ÿç®¡ç†å‘˜** æˆ–è€…æˆæƒç”¨æˆ·è®¿é—®ä¸“é—¨çš„ç³»ç»Ÿè°ƒç”¨

---

## éšè”½æ‰«æ â€”â€” TCP Xmas æ‰«æ {id="tcp-xmas-scan"}

| åºå· | é€šä¿¡æ–¹å‘ | æµç¨‹ 1                            | æµç¨‹ 2                            |
| --   | --       | --                                | --                                |
| 1    | C -> S   | TCP FIN(1),PUSH(1),URG(1)+Port(n) | TCP FIN(1),PUSH(1),URG(1)+Port(n) |
| 2    | S -> C   | RST                               | æ— å“åº”/å…¶ä»–æ‹’ç»åé¦ˆæŠ¥æ–‡           |
|      | çŠ¶æ€æ¨æ–­ | å…³é—­  â›”                          | å¼€æ”¾ âœ… / å…³é—­  â›” / è¢«è¿‡æ»¤ âš ï¸     |

---

## éšè”½æ‰«æ â€”â€” TCP Null æ‰«æ {id="tcp-null-scan"}

| åºå· | é€šä¿¡æ–¹å‘ | æµç¨‹ 1                            | æµç¨‹ 2                            |
| --   | --       | --                                | --                                |
| 1    | C -> S   | TCP FIN(0),PUSH(0),URG(0)+Port(n) | TCP FIN(0),PUSH(0),URG(0)+Port(n) |
| 2    | S -> C   | RST                               | æ— å“åº”/å…¶ä»–æ‹’ç»åé¦ˆæŠ¥æ–‡           |
|      | çŠ¶æ€æ¨æ–­ | å…³é—­  â›”                          | å¼€æ”¾ âœ… / å…³é—­  â›” / è¢«è¿‡æ»¤ âš ï¸     |

---

## éšè”½æ‰«æ â€”â€” TCP Xmas å’Œ Null æ‰«æ {id="tcp-hidden-scan"}

* å®ç°åŸç†
    * Xmas: è®¾ç½® TCP æŠ¥æ–‡å¤´ FINã€URG å’Œ PUSH æ ‡è®°
    * Nullï¼šå…³é—­æ‰€æœ‰ TCP æŠ¥æ–‡å¤´æ ‡è®°
* ä¼˜ç‚¹
    * éšè”½æ€§å¥½
* ç¼ºç‚¹	
    * éœ€è¦è‡ªå·±æ„é€ æ•°æ®åŒ…ï¼Œè¦æ±‚æœ‰ **æ“ä½œç³»ç»Ÿç®¡ç†å‘˜** æˆ–è€…æˆæƒç”¨æˆ·æƒé™

---

## éšè”½æ‰«æâ€”â€”åˆ†æ®µæ‰«æ

* å®ç°åŸç†
    * å°†ä¸€ä¸ªå®Œæ•´ TCP æŠ¥æ–‡åˆ†å‰²å°è£…åˆ° 2 ä¸ªæˆ–å¤šä¸ª IP æŠ¥æ–‡åˆ†åˆ«ç‹¬ç«‹å‘é€
* ä¼˜ç‚¹
    * éšè”½æ€§å¥½ï¼Œå¯ç©¿è¶Šé˜²ç«å¢™
* ç¼ºç‚¹
    * å¯èƒ½è¢«ä¸¢å¼ƒ
    * æŸäº›ç¨‹åºåœ¨å¤„ç†è¿™äº›å°æ•°æ®åŒ…æ—¶ä¼šå‡ºç°å¼‚å¸¸

---

## éšè”½æ‰«æ â€”â€” ACK æ‰«æ {id="tcp-ack-scan-1"}

| åºå· | é€šä¿¡æ–¹å‘ | æµç¨‹ 1                 | æµç¨‹ 2      |
| --   | --       | --                     | --          |
| 1    | C -> S   | ACK+Port(n)            | ACK+Port(n) |
| 2    | S -> C   | RST / å…¶ä»–æ‹’ç»åé¦ˆæŠ¥æ–‡ | æ— å“åº”      |
|      | çŠ¶æ€æ¨æ–­ | è¢«è¿‡æ»¤ âš ï¸               | å…³é—­  â›”    |

---

## éšè”½æ‰«æ â€”â€” ACK æ‰«æ {id="tcp-ack-scan-2"}

* å®ç°åŸç†
    * æ„é€ å¹¶å‘é€ ACK æŠ¥æ–‡
    * åŒ…è¿‡æ»¤é˜²ç«å¢™ä¼šæ£€æŸ¥ TCP ä¼šè¯çŠ¶æ€åˆ—è¡¨ï¼Œè‹¥å‘ç°æ— åŒ¹é…ä¼šè¯åˆ™æœ‰å¯èƒ½è¿”å› RST æŠ¥æ–‡
    * æ­£å¸¸ä¸»æœºçš„å…³é—­ç«¯å£åˆ™ä¸ä¼šå“åº”è¯¥æŠ¥æ–‡
* ä¼˜ç‚¹
    * æ¢æµ‹ç›®æ ‡ä¸»æœºçš„åŒ…è¿‡æ»¤è§„åˆ™
* ç¼ºç‚¹
    * å¯èƒ½è¢«ä¸¢å¼ƒ
    * ä¸èƒ½ç”¨äºåˆ¤æ–­ç«¯å£æ˜¯å¦å¼€æ”¾

---

## éšè”½æ‰«æ â€”â€” IDLE æ‰«æ {id="tcp-idle-scan-1"}

* è·³æ¿ä¸»æœºå¤„äºç½‘ç»œç©ºé—²çŠ¶æ€
* è·³æ¿ä¸»æœºçš„IPåºåˆ—å·äº§ç”Ÿè§„åˆ™æ˜¯è¿ç»­é€’å¢
* å¹¿åŸŸç½‘ä¸Šçš„è·¯ç”±å™¨å¿…é¡»å…è®¸ä¼ªé€ æºIPåœ°å€

![TCP Idle æ‰«æ](images/chap0x05/tcp-idle-scan.png)

---

## éšè”½æ‰«æ â€”â€” IDLE æ‰«æ {id="tcp-idle-scan-2"}

* å®ç°åŸç†
    * å¦‚å‰å›¾æ‰€ç¤º
* ä¼˜ç‚¹
    * ç›¸æ¯”è¾ƒäº TCP é—´æ¥æ‰«æï¼Œæ— éœ€ç›‘å¬è·³æ¿ä¸»æœºçš„é€šä¿¡æµé‡
    * ç›®æ ‡ä¸»æœºå¾ˆéš¾å‘ç°çœŸæ­£çš„æ‰«ææºï¼Œæ‰«æéšè”½æ€§é«˜
* ç¼ºç‚¹
    * å¯¹è·³æ¿ä¸»æœºçš„è¦æ±‚è¾ƒå¤š

# æ ˆæŒ‡çº¹ OS è¯†åˆ«æŠ€æœ¯ {id="os-detection-techniques-1"}

---

* å®ç°åŸç†
    * æ ¹æ®å„ä¸ªæ“ä½œç³»ç»Ÿåœ¨ TCP/IP åè®®æ ˆå®ç°ä¸Šçš„ä¸åŒç‰¹ç‚¹
    * é‡‡ç”¨é»‘ç›’æµ‹è¯•æ–¹æ³•
    * ç ”ç©¶å…¶å¯¹å„ç§æ¢æµ‹çš„å“åº”å½¢æˆè¯†åˆ«æŒ‡çº¹è¿›è¡Œè¯†åˆ«
* æ ¹æ®é‡‡é›†æŒ‡çº¹ä¿¡æ¯çš„æ–¹å¼ï¼Œåˆ†ä¸º
    * è¢«åŠ¨æ‰«ææ–¹å¼
    * ä¸»åŠ¨æ‰«ææ–¹å¼

---

## è¢«åŠ¨æ‰«æ

* å®ç°åŸç†
    * é€šè¿‡ç½‘ç»œå—…æ¢å·¥å…·æ”¶é›†æ•°æ®åŒ…ï¼Œå†å¯¹æ•°æ®åŒ…çš„ä¸åŒç‰¹å¾ï¼ˆTCP Window-sizeã€IP TTLã€IP TOSã€DFä½ç­‰å‚æ•°ï¼‰è¿›è¡Œåˆ†æï¼Œæ¥è¯†åˆ«æ“ä½œç³»ç»Ÿ
* ä¼˜ç‚¹
    * éšè”½æ€§å¥½
* ç¼ºç‚¹
    * é€Ÿåº¦æ…¢
    * å¯é æ€§ä¸é«˜

---

## ä¸»åŠ¨æ‰«æ

* å®ç°åŸç†
    * é‡‡ç”¨å‘ç›®æ ‡ç³»ç»Ÿå‘é€æ„é€ çš„ç‰¹æ®ŠåŒ…å¹¶ç›‘æ§å…¶åº”ç­”çš„æ–¹å¼æ¥è¯†åˆ«æ“ä½œç³»ç»Ÿçš„ç±»å‹
* ä¼˜ç‚¹
    * é€Ÿåº¦å¿«ï¼Œå¯é æ€§é«˜
* ç¼ºç‚¹
    * ä¸¥é‡ä¾èµ–ç›®æ ‡ç³»ç»Ÿç½‘ç»œæ‹“æ‰‘ç»“æ„å’Œè¿‡æ»¤è§„åˆ™

---

### Windows æŒ‡çº¹ç¤ºä¾‹ {id="windows-os-fingerprint"}

![](images/chap0x05/windows-os-fingerprint.png)

---

* Windows ä¸»æœºçš„ ping ç¨‹åºå®ç°ç‰¹å¾
    * TTL
    * payload
        * Data
        * Length

---

### Linux æŒ‡çº¹ç¤ºä¾‹ {id="linux-os-fingerprint"}

![](images/chap0x05/linux-os-fingerprint.png)

---

* Linux ä¸»æœºçš„ ping ç¨‹åºå®ç°ç‰¹å¾
    * TTL
    * payload
        * Data
        * Length

---

![ä»…ä»…é€šè¿‡ ping å³å¯ç²—ç•¥çš„åˆ¤å®šç›®æ ‡æ“ä½œç³»ç»Ÿç±»å‹](images/chap0x05/ping-detect-os.png)

---

## æ ˆæŒ‡çº¹ OS è¯†åˆ«çš„å…¶ä»–æŠ€æœ¯  {id="os-detection-techniques-2"}

* FIN æ¢æµ‹
    * å‘é€ä¸€ä¸ª FIN åŒ…ç»™ä¸€ä¸ªå¼€æ”¾ç«¯å£ï¼Œä¸€èˆ¬çš„è¡Œä¸ºæ˜¯ä¸å“åº”ï¼Œä½†æŸäº›å®ç°ä¾‹å¦‚ MS Windows, BSDI, CISCO, HP/UX, MVS, IRIX ç­‰ä¼š å“åº”ä¸€ä¸ª RST æŠ¥æ–‡
* BOGUS æ ‡è®°æ¢æµ‹
    * è®¾ç½®ä¸€ä¸ªæœªå®šä¹‰çš„ TCP æ ‡è®°ï¼ˆ64æˆ–128ï¼‰åœ¨ SYN åŒ…çš„ TCP å¤´é‡Œ
* ä¸åˆ†æ®µä½
    * è®¸å¤šæ“ä½œç³»ç»Ÿå¼€å§‹åœ¨é€å‡ºçš„ä¸€äº›åŒ…ä¸­è®¾ç½®IPçš„ `Don't Fragment` ä½

---

## æ ˆæŒ‡çº¹ OS è¯†åˆ«çš„å…¶ä»–æŠ€æœ¯  {id="os-detection-techniques-3"}

* ACK å€¼
    * ä¸åŒå®ç°ä¸­ä¸€äº›æƒ…å†µä¸‹ ACK åŸŸçš„å€¼æ˜¯ä¸åŒçš„
* ICMP é”™è¯¯ä¿¡æ¯ç»ˆç»“
    * ä¸€äº›æ“ä½œç³»ç»Ÿè·Ÿä»é™åˆ¶å„ç§é”™è¯¯ä¿¡æ¯çš„å‘é€ç‡
* SYN æ´ªæ°´é™åº¦
    * å¦‚æœæ”¶åˆ°è¿‡å¤šçš„ä¼ªé€  SYN æ•°æ®åŒ…ï¼Œä¸€äº›æ“ä½œç³»ç»Ÿä¼šåœæ­¢æ–°çš„è¿æ¥å°è¯•
    * æŸäº›æ“ä½œç³»ç»Ÿé»˜è®¤åªå¤„ç† 8 ä¸ªä¼ªé€ çš„ SYN åŒ…	

---

## å°ç»“ï¼šæ‰«æçŸ¥è¯†åº“æ„å»ºä¸è§„åˆ™åŒ¹é…

* åœ¨æ‰«æå®è·µä¸­æ€»ç»“çŸ¥è¯†åº“æ„å»º
    * TCP/IPåè®®æ ˆçš„æ¯ä¸€å±‚
    * æŠ¥æ–‡çš„å‘é€å’Œæ¥æ”¶å‡æœ‰è§„å¾‹å¯å¾ªï¼Œæœ‰è§„åˆ™å¯æ€»ç»“
    * é»‘ç›’æ¨¡ç³Šæµ‹è¯•æ€æƒ³
* è§„åˆ™åŒ¹é…
    * ä¸ä»…ä»…æ˜¯å­—ç¬¦ä¸²é™æ€åŒ¹é…
    * å¯ä»¥æ˜¯åŸºäºè¡Œä¸ºçš„åŒ¹é…
        * ä¼šè¯ï¼šä¼ è¾“å±‚ / åº”ç”¨å±‚
        * æŠ¥æ–‡äº¤äº’åºåˆ—

# æ‰«ææŠ¥å‘Šç”Ÿæˆ

---

* æ•°æ®çš„å¯è§†åŒ–å‘ˆç°æŠ€æœ¯

> éæœ¬è¯¾ç¨‹å…³æ³¨é‡ç‚¹

# æ‰«æè¡Œä¸ºçš„æ£€æµ‹ä¸é˜²æŠ¤

---

* æ‰«æè¡Œä¸ºçš„æ£€æµ‹
    * è¢«åŠ¨ç›‘å¬
        * åˆ©ç”¨ç¬¬å››ç« æ‰€å­¦çš„çŸ¥è¯†ã€å·¥å…·å’Œæ–¹æ³•
* æ‰«æè¡Œä¸ºçš„é˜²æŠ¤
    * é˜²ç«å¢™
        * å°†åœ¨ç¬¬å…«ç« ä»‹ç»
    * å…¥ä¾µæ£€æµ‹
        * å°†åœ¨ç¬¬ä¹ç« ä»‹ç»

# ç½‘ç»œæ‰«æå·¥å…·

---

![ç”µå½±ä¸­çš„ç½‘ç»œæ‰«æå·¥å…·](images/chap0x05/nmap-in-movies.png)

---

## Nmap

* Nmap ç®€ä»‹
* Nmap ä½¿ç”¨æ–¹æ³•
* ping æ‰«æ
    * ç«¯å£æ‰«æ
    * éšè”½æ‰«æ
    * é€‰é¡¹åŠŸèƒ½
        * æ“ä½œç³»ç»Ÿè¯†åˆ«
        * é˜²ç«å¢™/IDSèº²é¿å’Œå“„éª—
* Nmap å¸¸è§åº”ç”¨

---

### Nmap ç®€ä»‹ {id="intro-2-nmap"}

* Network Mapperçš„ç¼©å†™
* åŠŸèƒ½ç‰¹æ€§ï¼ˆ **ç½‘ç»œæ‰«æçš„ç‘å£«å†›åˆ€** ï¼‰
    * å¤šç§åè®®æ‰«æ
        * ä¾‹å¦‚ï¼šTCP / UDP / ICMP
    * æ”¯æŒå¤§å¤šæ•°ç³»ç»Ÿ
        * ä¾‹å¦‚ï¼šLinux, macOS, Microsoft Windows
    * æ”¯æŒæ’ä»¶æ‰©å±•
        * NSE: Nmap Script Engine

---

### Nmap åº”ç”¨ç¨‹åºç›®å½•ç»“æ„è§£æ

* å¯æ‰§è¡Œç¨‹åºç›®å½•
    * /usr/bin
* æ–‡æ¡£ç›®å½•
    * /usr/share/man
    * /usr/share/doc/nmap
* æ’ä»¶ç›®å½•
    * /usr/share/nmap/nselib **é‡ç‚¹å…³æ³¨**
    * /usr/share/nmap/scripts **é‡ç‚¹å…³æ³¨**
* çŸ¥è¯†åº“ç›®å½•
    * /usr/share/nmap

---

```bash
dpkg -L nmap
dpkg -L nmap-common
```

---

> /usr/share/nmap

| æ–‡ä»¶                | ä½œç”¨è¯´æ˜                      |
| --                  | --                            |
| nmap-mac-prefixes   | MACåœ°å€å¯¹åº”å‚å®¶çŸ¥è¯†åº“         |
| nmap-os-db          | æ“ä½œç³»ç»ŸæŒ‡çº¹çŸ¥è¯†åº“            |
| nmap-protocols      | åè®®ç±»å‹å­—æ®µæ ‡è¯†çŸ¥è¯†åº“        |
| nmap-rpc            | RPCåº”ç”¨ç±»å‹æŒ‡çº¹çŸ¥è¯†åº“         |
| nmap-service-probes | åº”ç”¨ç¨‹åºäº¤äº’è¡Œä¸ºæŒ‡çº¹çŸ¥è¯†åº“    |
| nmap-services       | ç«¯å£ä¸åº”ç”¨/æœåŠ¡æ˜ å°„å…³ç³»çŸ¥è¯†åº“ |

---

## nmap æ‰«æä¸€èˆ¬æµç¨‹ {id="nmap-scan-flow"}

![](images/chap0x05/nmap-scan-flow.png)

---

## nmap ä½¿ç”¨å¸®åŠ© {id="howto-get-help"}

> nmap --help

> man nmap

---

## nmap å®éªŒæŒ‡å— {id="howto-use-nmap"}

* å‰è¿°æ‰«æåŸç†åœ¨ nmap ä¸­çš„å¯¹åº”å‘½ä»¤è¡Œå‚æ•°ç»„åˆå®ç°
* æ“ä½œç³»ç»Ÿè¯†åˆ«
* é˜²ç«å¢™/å…¥ä¾µæ£€æµ‹èº²é¿å’Œå“„éª—

---

> nmap cheatsheet

# è¯¾åæ€è€ƒé¢˜

---

* é€šè¿‡æœ¬ç« ç½‘ç»œæ‰«æåŸºæœ¬åŸç†çš„å­¦ä¹ ï¼Œè¯•æ¨æµ‹
    * åº”ç”¨ç¨‹åºç‰ˆæœ¬ä¿¡æ¯æ‰«æåŸç†
    * ç½‘ç»œæ¼æ´æ‰«æåŸç†
* ç½‘ç»œæ‰«æçŸ¥è¯†åº“çš„æ„å»ºæ–¹æ³•æœ‰å“ªäº›ï¼Ÿ
* é™¤äº† nmap ä¹‹å¤–ï¼Œç›®å‰è¿˜æœ‰å“ªäº›æµè¡Œçš„ç½‘ç»œæ‰«æå™¨ï¼Ÿå’Œ nmap è¿›è¡Œä¼˜ç¼ºç‚¹å¯¹æ¯”åˆ†æã€‚

