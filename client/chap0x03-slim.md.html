<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="é»„ç®">
  <title>ç½‘ç»œå®‰å…¨</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="lib/reveal.js/css/reveal.css">
  <style type="text/css">code{white-space: pre;}</style>


    <!-- For syntax highlighting using highlight.js-->
    <link rel="stylesheet" href="lib/reveal.js/lib/css/zenburn.css">

  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <link rel="stylesheet" href="lib/reveal.js/css/theme/white.css" id="theme">
  <!-- Printing and PDF exports -->
<link rel="stylesheet" media="print" href="lib/reveal.js/css/print/pdf.css" />
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'lib/reveal.js/css/print/pdf.css' : 'lib/reveal.js/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="lib/reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">ç½‘ç»œå®‰å…¨</h1>
  <p class="author">é»„ç®</p>
</section>

<section>
<section id="ç¬¬ä¸‰ç« -ç½‘ç»œå®‰å…¨åº”ç”¨åŸºç¡€" class="title-slide slide level1">
<h1>ç¬¬ä¸‰ç«  ç½‘ç»œå®‰å…¨åº”ç”¨åŸºç¡€</h1>

</section>
<section id="æ¸©æ•…" class="slide level2">
<h2>æ¸©æ•…</h2>
<ul>
<li>TCP/IPç½‘ç»œåˆ†å±‚æ¨¡å‹</li>
<li>å®‰å…¨ä¸‰è¦ç´ : CIA</li>
<li>ç§æœ‰åœ°å€</li>
<li>å…¬æœ‰åœ°å€</li>
<li>æ•°å­—æ ‡è¯†
<ul>
<li>ç½‘ç»œæ ‡è¯†</li>
<li>ä¸»æœºæ ‡è¯†</li>
</ul></li>
</ul>
</section>
<section id="çŸ¥æ–°" class="slide level2">
<h2>çŸ¥æ–°</h2>
<ul>
<li>IPåœ°å€ä¸èƒ½ä½œä¸ºç¡®è®¤æ”»å‡»è€…èº«ä»½çš„å”¯ä¸€æ ‡è¯†</li>
<li>æºå’Œç›®çš„åœ°å€éƒ½æ˜¯ç§æœ‰åœ°å€çš„æ•°æ®åŒ…ä¹Ÿèƒ½åœ¨â€œå…¬ç½‘â€ä¸Šä¼ è¾“</li>
<li>ä»£ç†æœåŠ¡çš„å®ç°å½¢å¼å¤šç§å¤šæ ·
<ul>
<li>å…¬å¼€åè®®</li>
<li>ç§æœ‰åè®®</li>
</ul></li>
</ul>
</section>
<section id="æœ¬ç« å†…å®¹æè¦" class="slide level2">
<h2>æœ¬ç« å†…å®¹æè¦</h2>
<ul>
<li>å¸¸è§ä»£ç†æœåŠ¡
<ul>
<li>HTTPä»£ç†</li>
<li>è™šæ‹Ÿä¸“ç”¨ç½‘(VPN)</li>
<li>SOCKSä»£ç†</li>
</ul></li>
<li>é«˜çº§ä»£ç†æœåŠ¡</li>
<li>ä»£ç†æœåŠ¡çš„æ£€æµ‹</li>
</ul>
</section>
</section>
<section>
<section id="ç»å…¸ä»£ç†æœåŠ¡æ¨¡å‹" class="title-slide slide level1">
<h1>ç»å…¸ä»£ç†æœåŠ¡æ¨¡å‹</h1>

</section>
<section class="slide level2">

<figure>
<img data-src="images/chap0x03/proxy-model.png" alt="" /><figcaption>ç»å…¸ä»£ç†æœåŠ¡æ¨¡å‹</figcaption>
</figure>
</section>
<section class="slide level2">

<ul>
<li>ä»£ç†æœåŠ¡å™¨åŒæ—¶æ‰®æ¼”æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸¤ç§è§’è‰²</li>
<li>ä»£ç†æœåŠ¡å™¨æ˜¯å®¢æˆ·ä¸æœåŠ¡å™¨å…³ç³»çš„ <font color="red">ä¸­é—´äºº</font></li>
<li>ã€Œç¼“å­˜ã€ä½œä¸ºå¯é€‰ç»„ä»¶æ˜¯å¸¸è§çš„ã€Œå®‰å…¨é£é™©ç‚¹ã€</li>
</ul>
</section>
<section id="ç½‘ç»œä»£ç†çš„åŸºæœ¬ç±»å‹" class="slide level2">
<h2>ç½‘ç»œä»£ç†çš„åŸºæœ¬ç±»å‹</h2>
<ul>
<li><strong>æ­£å‘</strong> ä»£ç†
<ul>
<li>è½¬å‘ä»£ç†ï¼Œæœ€å¸¸è§
<ul>
<li>å¼€æ”¾ä»£ç†
<ul>
<li>äº’è”ç½‘ä¸Šäººäººå¯è®¿é—®çš„ <code>è½¬å‘ä»£ç†</code></li>
</ul></li>
</ul></li>
</ul></li>
<li><strong>åå‘</strong> ä»£ç†
<ul>
<li>å°†å®¢æˆ·ç«¯è¯·æ±‚è½¬å‘ç»™åç«¯æœåŠ¡å™¨é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹å¤„ç†å¹¶è¿”å›å¤„ç†ç»“æœç»™å®¢æˆ·ç«¯</li>
</ul></li>
</ul>
</section>
<section id="æ­£å‘ä»£ç†çš„åº”ç”¨åœºæ™¯" class="slide level2">
<h2>æ­£å‘ä»£ç†çš„åº”ç”¨åœºæ™¯</h2>
<ul>
<li>è¿‡æ»¤
<ul>
<li>å†…å®¹è¿‡æ»¤</li>
</ul></li>
<li>ç¼“å­˜</li>
<li>ç»•è¿‡å†…å®¹è¿‡æ»¤å’Œç½‘ç»œå®¡æŸ¥</li>
<li>æ—¥å¿—å’Œå—…æ¢</li>
<li>ç§æœ‰ç½‘ç»œçš„ç½‘å…³</li>
<li>åŒ¿åæœåŠ¡è®¿é—®</li>
</ul>
</section>
<section id="åå‘ä»£ç†çš„åº”ç”¨åœºæ™¯" class="slide level2">
<h2>åå‘ä»£ç†çš„åº”ç”¨åœºæ™¯</h2>
<ul>
<li>æå‡åŠ å¯†é“¾æ¥æ€§èƒ½</li>
<li>è´Ÿè½½å‡è¡¡</li>
<li>é™æ€å†…å®¹ç¼“å­˜</li>
<li>å‹ç¼©ï¼ˆä»£ç†ï¼‰</li>
<li>é€‚é…ä½ç½‘é€Ÿå®¢æˆ·ç«¯</li>
<li>å®‰å…¨ç½‘å…³</li>
<li>å¤–ç½‘å‘å¸ƒ</li>
</ul>
</section>
<section id="proxy-apps-1" class="slide level2">
<h2>ç½‘ç»œä»£ç†çš„åº”ç”¨ â€”â€” äº¦æ­£äº¦é‚ª</h2>
<ul>
<li>âœ… åŠ å¯†é€šä¿¡æ•°æ®*
<ul>
<li>é˜²æ­¢é€šä¿¡æ•°æ®è¢«çªƒå¬å’Œç¯¡æ”¹ï¼ˆæœºå¯†æ€§å’Œå®Œæ•´æ€§ä¿æŠ¤ï¼‰</li>
</ul></li>
<li>â›‘ å®¡æŸ¥ç½‘ç»œé€šä¿¡æ•°æ®*
<ul>
<li>æ¶æ„æµé‡æ£€æµ‹å’Œè¿‡æ»¤</li>
<li>å¤±æ³„å¯†è¡Œä¸ºå‘ç°å’Œé˜»æ­¢</li>
</ul></li>
<li>ğŸ’¡ æ”¹å˜ç½‘ç»œæ‹“æ‰‘ç»“æ„*
<ul>
<li>è·¨å±€åŸŸç½‘/å¼‚æ„ç½‘ç»œé€šä¿¡</li>
</ul></li>
</ul>
<blockquote>
<p><code>* è§†å…·ä½“ä»£ç†æœåŠ¡å®ç°æŠ€æœ¯è€Œå®š</code></p>
</blockquote>
</section>
<section class="slide level2">

<h3 id="å®¡æŸ¥ç½‘ç»œé€šä¿¡æ•°æ®">â›‘ å®¡æŸ¥ç½‘ç»œé€šä¿¡æ•°æ®</h3>
<ul>
<li>ç”¨æˆ·éšç§ ğŸ†š ç½‘ç»œä¸ç³»ç»Ÿå®‰å…¨</li>
</ul>
</section>
<section id="proxy-apps-2" class="slide level2">
<h2>ç½‘ç»œä»£ç†çš„åº”ç”¨ â€”â€” äº¦æ­£äº¦é‚ª</h2>
<ul>
<li>âš ï¸ éšè—æ¥æº IP</li>
<li>âš ï¸ ç»•è¿‡ç½‘ç»œå®‰å…¨å®¡æŸ¥/æ£€æµ‹æœºåˆ¶</li>
</ul>
<blockquote>
<p>å¨èƒç½‘ç»œå®‰å…¨æ£€æµ‹ã€ç›‘æµ‹ã€å®¡è®¡æœºåˆ¶</p>
</blockquote>
</section>
<section class="slide level2">

<p>ç½‘ç»œå®‰å…¨çš„ <font color="red">å¯¹æŠ—</font> æœ¬è´¨åœ¨ã€Œä»£ç†æŠ€æœ¯ã€çš„åº”ç”¨ä¸­ä½“ç°åœ°æ·‹æ¼“å°½è‡´ã€‚</p>
</section>
</section>
<section>
<section id="http-proxy" class="title-slide slide level1">
<h1>HTTP ä»£ç†</h1>

</section>
<section id="http-review-1" class="slide level2">
<h2>å›é¡¾ HTTP</h2>
<ul>
<li>RFC 2616: Hypertext Transfer Protocol â€“ HTTP/1.1</li>
<li>RFC 2617: HTTP Authentication: Basic and Digest Access Authentication</li>
<li>RFC 2818: HTTP Over TLS</li>
<li>RFC 6265: HTTP State Management Mechanism</li>
<li>RFC 2145 : Use and Interpretation of HTTP Version Numbers - Informational</li>
<li>MIMEç›¸å…³RFC
<ul>
<li>RFC 2045, RFC 2046, RFC 2047, RFC 4288, RFC 4289, RFC 2049</li>
</ul></li>
</ul>
</section>
<section id="http-review-2" class="slide level2">
<h2>å›é¡¾ HTTP</h2>
<ul>
<li>HTTP ï¼ˆä¼šè¯ï¼‰åŸºæœ¬è¿‡ç¨‹
<ul>
<li>å»ºç«‹è¿æ¥ï¼ˆè¿æ¥å‡†å¤‡ã€è¿æ¥ï¼‰</li>
<li>å®¢æˆ·ç«¯å‘é€è¯·æ±‚ / æœåŠ¡å™¨å‘é€å“åº”</li>
<li>å…³é—­è¿æ¥</li>
</ul></li>
</ul>
</section>
<section id="http-proxy-types" class="slide level2">
<h2>HTTP ä»£ç†ç±»å‹</h2>
<ul>
<li>æ­£å‘ä»£ç†
<ul>
<li>é€šå¸¸æ„ä¹‰ä¸Šçš„â€œä»£ç†â€
<ul>
<li>æ”¹å˜é€šä¿¡æ•°æ®å†…å®¹*</li>
</ul></li>
</ul></li>
<li>åå‘ä»£ç†
<ul>
<li>é¢å‘ç”¨æˆ·å®Œå…¨é€æ˜
<ul>
<li>å¯¹é€šä¿¡å†…å®¹æ— ä¿®æ”¹*</li>
</ul></li>
</ul></li>
</ul>
<blockquote>
<p>`* å’ŒHTTP ä»£ç†çš„å·¥ä½œæ¨¡å¼æœ‰å…³</p>
</blockquote>
</section>
<section class="slide level2">

<h3 id="ä¸åŒæµè§ˆå™¨çš„æ­£å‘ä»£ç†è®¾ç½®æ–¹æ³•">ä¸åŒæµè§ˆå™¨çš„ï¼ˆæ­£å‘ï¼‰ä»£ç†è®¾ç½®æ–¹æ³•</h3>
<blockquote>
<p><æµè§ˆå™¨åç§°> è®¾ç½®ä»£ç†</p>
</blockquote>
<p><img data-src="images/chap0x03/proxy-setup-chrome-example.png" /></p>
</section>
<section class="slide level2">

<h3 id="proxy-setup-pitfalls-1">æµè§ˆå™¨ä»£ç†è®¾ç½®çš„å¸¸è§é™·é˜±</h3>
<p><img data-src="images/chap0x03/proxy-setup-firefox-options-1.png" /></p>
</section>
<section class="slide level2">

<h4 id="what-happened-after-url-typedin-1">æµè§ˆå™¨è¾“å…¥URL åå‘ç”Ÿäº†ä»€ä¹ˆ</h4>
<figure>
<img data-src="images/chap0x03/what-happened-after-url-typedin.png" alt="" /><figcaption>ç²¾ç®€ç‰ˆæµè§ˆå™¨è®¿é—® Web ç«™ç‚¹æµç¨‹å›¾</figcaption>
</figure>
</section>
<section class="slide level2">

<h3 id="proxy-setup-pitfalls-2">æµè§ˆå™¨ä»£ç†è®¾ç½®çš„å¸¸è§é™·é˜±</h3>
<p><img data-src="images/chap0x03/proxy-setup-firefox-options-2.png" /></p>
</section>
<section class="slide level2">

<h4 id="what-happened-after-url-typedin-2">æµè§ˆå™¨è¾“å…¥URL åå‘ç”Ÿäº†ä»€ä¹ˆ</h4>
<figure>
<img data-src="images/chap0x03/what-happened-after-url-typedin-proxy-mode.png" alt="" /><figcaption>ä»£ç†æ¨¡å¼çš„è®¿é—®æµç¨‹ç®€å›¾</figcaption>
</figure>
</section>
<section class="slide level2">

<ul>
<li>å¦‚æœ DNS è§£æçš„ç»“æœã€Œè¢«æ±¡æŸ“ã€ï¼Ÿ</li>
<li>å¦‚æœ <code>ä»£ç†æœåŠ¡å™¨</code> å®¡æŸ¥ç”¨æˆ·çš„ <code>è®¿é—®è¯·æ±‚</code> å’ŒæœåŠ¡å™¨ <code>å“åº”å†…å®¹</code> ï¼Ÿ</li>
</ul>
</section>
<section id="http-ä»£ç†çš„ä¸»è¦ç”¨é€”" class="slide level2">
<h2>HTTP ä»£ç†çš„ä¸»è¦ç”¨é€”</h2>
<ul>
<li>è®¿é—®å—é™åˆ¶çš„Webç«™ç‚¹
<ul>
<li>é™åˆ¶æœºåˆ¶ï¼šæ ¹æ®å®¢æˆ·ç«¯æ¥æºIPè¿‡æ»¤</li>
</ul></li>
<li>ä¼˜åŒ–Webç«™ç‚¹è®¿é—®é€Ÿåº¦
<ul>
<li>é¢„å…ˆç¼“å­˜å®¢æˆ·ç«¯è¦è®¿é—®çš„æ•°æ®</li>
</ul></li>
<li>å†…å®¹å®¡æŸ¥
<ul>
<li>å‘ç°æ¶æ„å†…å®¹å¹¶åŠ ä»¥è¿‡æ»¤é˜»æ­¢</li>
</ul></li>
</ul>
</section>
<section id="http-ä»£ç†çš„å·¥ä½œæ¨¡å¼" class="slide level2">
<h2>HTTP ä»£ç†çš„å·¥ä½œæ¨¡å¼</h2>
<ul>
<li><code>X-Forwarded-For</code> (XFF)
<ul>
<li>é RFC æ ‡å‡†å®šä¹‰</li>
<li>Squid ä»£ç†çš„å¼€å‘äººå‘˜æœ€æ—©å¼•å…¥è¯¥ HTTP æ¶ˆæ¯å¤´</li>
<li>æ ‡è¯†å®¢æˆ·ç«¯çœŸå®IP</li>
<li><code>X-Forwarded-For: client1, proxy1, proxy2</code></li>
</ul></li>
<li>åŒ¿åä»£ç†
<ul>
<li>ä¸æä¾› <code>X-Forwarded-For</code> å­—æ®µ</li>
</ul></li>
<li>éåŒ¿åä»£ç†
<ul>
<li>æä¾› <code>X-Forwarded-For</code> å­—æ®µ</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<h3 id="å®é™…åº”ç”¨ä¸­çš„-http-ä»£ç†ç±»å‹">å®é™…åº”ç”¨ä¸­çš„ HTTP ä»£ç†ç±»å‹</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">REMOTE_ADDR</th>
<th style="text-align: left;">HTTP_VIA</th>
<th style="text-align: left;">HTTP_X_FORWARDED_FOR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">é€æ˜ä»£ç†</td>
<td style="text-align: left;">æœ€åä¸€ä¸ªä»£ç†æœåŠ¡å™¨IP</td>
<td style="text-align: left;">ä»£ç†æœåŠ¡å™¨IPæˆ–å†…éƒ¨ä»£ç†åˆ«å</td>
<td style="text-align: left;">å®¢æˆ·ç«¯çœŸå®IPï¼Œæˆ–ï¼ˆç»è¿‡å¤šä¸ªä»£ç†æ—¶ï¼‰éµå¾ªXFFæ ‡å‡†</td>
</tr>
<tr class="even">
<td style="text-align: left;">æ™®é€šåŒ¿å</td>
<td style="text-align: left;">æœ€åä¸€ä¸ªä»£ç†æœåŠ¡å™¨IP</td>
<td style="text-align: left;">ä»£ç†æœåŠ¡å™¨IPæˆ–å†…éƒ¨ä»£ç†åˆ«å</td>
<td style="text-align: left;">éƒ¨åˆ†éµå¾ªXFFæ ‡å‡†ï¼ˆéšè—å®¢æˆ·ç«¯çœŸå®IPï¼‰</td>
</tr>
<tr class="odd">
<td style="text-align: left;">æ¬ºéª—ä»£ç†</td>
<td style="text-align: left;">ä»£ç†æœåŠ¡å™¨IP</td>
<td style="text-align: left;">ä»£ç†æœåŠ¡å™¨IPæˆ–å†…éƒ¨ä»£ç†åˆ«å</td>
<td style="text-align: left;">ä¼ªé€ ç»è¿‡çš„ä»£ç†æœåŠ¡å™¨IPåˆ—è¡¨</td>
</tr>
<tr class="even">
<td style="text-align: left;">é«˜åŒ¿åä»£ç†</td>
<td style="text-align: left;">ä»£ç†æœåŠ¡å™¨IP</td>
<td style="text-align: left;">æ— æ•°å€¼æˆ–ä¸æ˜¾ç¤º</td>
<td style="text-align: left;">æ— æ•°å€¼æˆ–ä¸æ˜¾ç¤º</td>
</tr>
</tbody>
</table>
<blockquote>
<p><a href="https://www.php.net/manual/en/reserved.variables.server.php">$_SERVER in PHP</a></p>
</blockquote>
</section>
<section class="slide level2">

<h3 id="ä»£ç†åœ°å€å®ä¾‹">ä»£ç†åœ°å€å®ä¾‹</h3>
<p><img data-src="images/chap0x03/proxy-server-examples.png" /></p>
</section>
<section class="slide level2">

<h3 id="æœ¬åœ°ä»£ç†æ¨¡æ‹Ÿå°å®éªŒ">æœ¬åœ°ä»£ç†æ¨¡æ‹Ÿå°å®éªŒ</h3>
<pre class="php"><code>// proxy.php
&lt;?php
var_dump($_SERVER);</code></pre>
<pre class="bash"><code># å¼€å¯ PHP æµ‹è¯•ç”¨æœåŠ¡å™¨
php -S 0.0.0.0:8080 proxy.php</code></pre>
<pre class="bash"><code># ä½¿ç”¨ curl æ¨¡æ‹Ÿä½¿ç”¨ä»£ç†æœåŠ¡å™¨çš„å®¢æˆ·ç«¯
curl -H &quot;X-Forwarded-For: 8.8.8.8&quot; http://127.0.0.1:8080/proxy.php
# æ ·ä¾‹è¾“å‡ºï¼ˆèŠ‚é€‰ï¼‰
# array(18) {
#   [&quot;REMOTE_ADDR&quot;]=&gt;
#   string(9) &quot;127.0.0.1&quot;
#   [&quot;HTTP_X_FORWARDED_FOR&quot;]=&gt;
#   string(7) &quot;8.8.8.8&quot;
# }</code></pre>
</section>
<section id="reverse-http-proxy" class="slide level2">
<h2>HTTP åå‘ä»£ç†</h2>
<p><img data-src="images/chap0x03/reverse-http-proxy.png" /></p>
</section>
<section class="slide level2">

<h3 id="reverse-http-proxy-usage">HTTP åå‘ä»£ç†ä¸»è¦ç”¨é€”</h3>
<ul>
<li>å†…ç½‘å¯¹å¤–æœåŠ¡çš„å ¡å’ä¸»æœº
<ul>
<li>è´Ÿè½½å‡è¡¡</li>
<li>ç¼“å†²</li>
</ul></li>
<li>å†…å®¹å°å·ç½‘ç«™
<ul>
<li>é»‘å¸½SEO</li>
</ul></li>
</ul>
</section>
</section>
<section>
<section id="http-proxy-exp" class="title-slide slide level1">
<h1>HTTP æ­£å‘ä»£ç†å®éªŒ</h1>

</section>
<section id="å¿…å¤‡ç†è®ºçŸ¥è¯†" class="slide level2">
<h2>å¿…å¤‡ç†è®ºçŸ¥è¯†</h2>
<ul>
<li><strong>H</strong>TTP <strong>S</strong>trict <strong>T</strong>ransport <strong>S</strong>ecurity</li>
<li><code>HSTS</code> å¼ºåˆ¶å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ‰€æœ‰é€šä¿¡æµé‡å¿…é¡»ä½¿ç”¨ HTTPS</li>
<li><code>HSTS</code> çš„å®ç°å¼ºçƒˆä¾èµ–äºã€Œå®¢æˆ·ç«¯ã€æ”¯æŒ
<ul>
<li>å†…ç½® <code>HSTS</code> ç«™ç‚¹åå•</li>
<li>é¦–æ¬¡è®¿é—®åæŒ‰ç…§æœåŠ¡å™¨çº¦å®šï¼Œåœ¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<h3 id="hsts-compatibility-check-matrix">HSTS çš„æµè§ˆå™¨æ”¯æŒæƒ…å†µæ±‡æ€»</h3>
<p><a href="https://caniuse.com/#feat=stricttransportsecurity"><img data-src="images/chap0x03/hsts-browser-support.png" /></a></p>
</section>
<section class="slide level2">

<h3 id="ä»¥-google-chrome-æµè§ˆå™¨ä¸ºä¾‹">ä»¥ Google Chrome æµè§ˆå™¨ä¸ºä¾‹</h3>
<p><a href="chrome://net-internals/#hsts">chrome://net-internals/#hsts</a></p>
<p><img data-src="images/chap0x03/hsts-in-chrome.png" /></p>
<blockquote>
<p>auth.alipay.com åªæœ‰è®¿é—®ä¸€æ¬¡æ‰èƒ½è¢«ã€Œè®°å¿†ã€</p>
</blockquote>
<ul>
<li><a href="https://www.chromium.org/hsts/">Chromium å†…ç½® HSTS ç«™ç‚¹åˆ—è¡¨</a></li>
</ul>
</section>
<section id="å®éªŒç¯å¢ƒ" class="slide level2">
<h2>å®éªŒç¯å¢ƒ</h2>
<ul>
<li>Kali Rolling</li>
<li><a href="https://tinyproxy.github.io/">tinyproxy</a></li>
<li>wireshark</li>
<li><a href="https://portswigger.net/burp">burpsuite</a> ï¼ˆè¯¾åå®éªŒç”¨ï¼‰</li>
</ul>
</section>
<section id="ä¸»è¦æ“ä½œæ­¥éª¤" class="slide level2">
<h2>ä¸»è¦æ“ä½œæ­¥éª¤</h2>
<pre class="bash"><code># å®‰è£… tinyproxy
apt update &amp;&amp; apt install tinyproxy

# å¯åŠ¨ tinyproxy
systemctl start tinyproxy

# è®¿é—®å‰è¿° proxy.php
curl -x http://127.0.0.1:8888 http://127.0.0.1:8080/proxy.php
# array(19) {
#   [&quot;REMOTE_ADDR&quot;]=&gt;
#   string(9) &quot;127.0.0.1&quot;
#   [&quot;HTTP_HOST&quot;]=&gt;
#   string(14) &quot;127.0.0.1:8080&quot;
#   [&quot;HTTP_VIA&quot;]=&gt;
#   string(32) &quot;1.1 tinyproxy (tinyproxy/1.10.0)&quot;
# }

# åœ¨å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸­åŠ å…¥å®¢æˆ·ç«¯çœŸå® IP
sed -i.bak &quot;s/#XTinyproxy Yes/XTinyproxy Yes/&quot; /etc/tinyproxy/tinyproxy.conf

# é‡å¯ tinyproxy æœåŠ¡
systemctl restart tinyproxy

# åœ¨ç‹¬ç«‹ shell çª—å£å¼€å¯ tinyproxy æ—¥å¿—ç›‘æ§å°ç¨‹åº
tail -F /var/log/tinyproxy/tinyproxy.log

# è®¿é—® HTTPS ç«™ç‚¹
curl -x http://127.0.0.1:8888 https://auth.alipay.com/login/index.htm

# æŸ¥çœ‹
# CONNECT   Jul 06 17:17:15 [7672]: Connect (file descriptor 7): localhost [127.0.0.1]
# CONNECT   Jul 06 17:17:15 [7672]: Request (file descriptor 7): CONNECT auth.alipay.com:443 HTTP/1.1
# INFO      Jul 06 17:17:15 [7672]: No upstream proxy for auth.alipay.com
# INFO      Jul 06 17:17:15 [7672]: opensock: opening connection to auth.alipay.com:443
# INFO      Jul 06 17:17:15 [7672]: opensock: getaddrinfo returned for auth.alipay.com:443
# CONNECT   Jul 06 17:17:15 [7672]: Established connection to host &quot;auth.alipay.com&quot; using file descriptor 8.
# INFO      Jul 06 17:17:15 [7672]: Not sending client headers to remote machine
# INFO      Jul 06 17:17:15 [7672]: Closed connection between local client (fd:7) and remote client (fd:8)

# æŸ¥çœ‹ HSTS å“åº”å¤´
curl -I -x http://127.0.0.1:8888 https://auth.alipay.com/login/index.htm
# HTTP/1.0 200 Connection established
# Proxy-agent: tinyproxy/1.10.0
# 
# HTTP/2 302
# server: nginx/1.6.2
# date: Mon, 06 Jul 2020 09:19:07 GMT
# content-length: 0
# location: https://authsa127.alipay.com:443/error.htm?exception_marking=the+requestMethod+%5BHEAD%5D+is+not+supported+by+handlers%2Cyou+can+try+with+%5BGET%2CPOST%5D%21&amp;messageCode=common.uncaughtException
# set-cookie: zone=RZ54A; Domain=.alipay.com; Path=/
# strict-transport-security: max-age=31536000
# set-cookie: JSESSIONID=05BCA44886FEE4B2C3368F9167D55C83; Path=/; HttpOnly
# set-cookie: JSESSIONID=05BCA44886FEE4B2C3368F9167D55C83; Path=; HttpOnly
# set-cookie: ALIPAYJSESSIONID=RZ54drLXXabsSYlmZr5T8qeGb1zCKyauthRZ54; Domain=.alipay.com; Path=/
# set-cookie: ctoken=UH5ZAmhY7PZUtB7I; Domain=.alipay.com; Path=/
# content-language: zh-CN
# set-cookie: spanner=8YfCP1RF/xNEmob8naEHjZVRrhGwKYJXXt2T4qEYgj0=;path=/;secure;
# via: spanner-internet-5405.sa127[302]</code></pre>
</section>
<section id="è¯¾åå®éªŒ" class="slide level2">
<h2>è¯¾åå®éªŒ</h2>
<ul>
<li><a href="https://c4pr1c3.github.io/cuc-ns/chap0x03/exp.html">è¯¦è§è¯¾æœ¬ä¸­æœ¬ç« å®éªŒ</a></li>
</ul>
</section>
</section>
<section>
<section id="socks-ä»£ç†" class="title-slide slide level1">
<h1>SOCKS ä»£ç†</h1>

</section>
<section class="slide level2">

<figure>
<img data-src="images/chap0x03/socks-proxy.png" alt="" /><figcaption>SOCKS ä»£ç†åŸºæœ¬åŸç†</figcaption>
</figure>
</section>
<section id="socks-proxy-usage" class="slide level2">
<h2>SOCKS ä»£ç†çš„åº”ç”¨</h2>
<ul>
<li>ç”µå­é‚®ä»¶</li>
<li>æ–°é—»ç»„è½¯ä»¶</li>
<li>ç½‘ç»œä¼ å‘¼</li>
<li>ç½‘ç»œèŠå¤©</li>
<li>ä½¿ç”¨ä»£ç†æœåŠ¡å™¨ã€Œè”ç½‘ã€æ‰“æ¸¸æˆ</li>
</ul>
</section>
<section id="å®æˆ˜ä½“éªŒ" class="slide level2">
<h2>å®æˆ˜ä½“éªŒ</h2>
<pre class="bash"><code># å»ºç«‹å®¿ä¸»æœºåˆ°è™šæ‹Ÿæœºçš„ SSH éš§é“ï¼ˆsocks5 ä»£ç†ï¼‰
# æ¨èä½¿ç”¨ Host-only ç½‘å¡å¯¹åº”çš„ VM IP ä½œä¸ºç›®æ ‡ IP
ssh -D 127.0.0.1:1080 cuc@192.168.56.136 -q -C -N -v

# ä½¿ç”¨ä¸Šè¿°å»ºç«‹çš„ SSH éš§é“è®¿é—®è™šæ‹Ÿæœºå†…çš„ã€Œæœ¬åœ°ç½‘é¡µã€
curl http://127.0.0.1:8080/proxy.php -x socks5://127.0.0.1:1080

# ä½¿ç”¨è¿œç¨‹æœåŠ¡å™¨å®Œæˆ DNS è§£æè¯·æ±‚
curl http://127.0.0.1:8080/proxy.php -x socks5://127.0.0.1:1080 --socks5-hostname 127.0.0.1:1080

# è‡ªè¡ŒæŠ“åŒ…ç ”ç©¶é€šä¿¡è¿‡ç¨‹
# TODO æ˜¯å¦å­˜åœ¨ã€Œå¯è¾¨è¯†ã€çš„ã€Œç½‘é¡µè®¿é—®ã€è¡Œä¸ºç—•è¿¹ï¼Ÿ

# æŸ¥çœ‹ PHP ç»ˆç«¯æ—¥å¿—
# TODO è®¿é—®æ¥æº IP æ˜¯ã€Œå®¿ä¸»æœºã€IP å—ï¼Ÿ</code></pre>
</section>
<section id="å¸¸è§ä»£ç†æœåŠ¡å°ç»“" class="slide level2">
<h2>å¸¸è§ä»£ç†æœåŠ¡å°ç»“</h2>
<ul>
<li>ä½¿ç”¨å¼€æ”¾ä»£ç†è¦è°¨æ…
<ul>
<li>é¿å…æ•æ„Ÿæ•°æ®è¢«å—…æ¢</li>
<li>é¿å…é‡è¦æ•°æ®è¢«ç¯¡æ”¹</li>
</ul></li>
<li>ä¸€èˆ¬æƒ…å†µä¸‹çš„ä»£ç†å®‰å…¨æ€§æ’åº
<ul>
<li>VPN â‰¥ Socksä»£ç† &gt; HTTPä»£ç†</li>
</ul></li>
</ul>
</section>
</section>
<section>
<section id="ä»£ç†æœåŠ¡çš„æ£€æµ‹" class="title-slide slide level1">
<h1>ä»£ç†æœåŠ¡çš„æ£€æµ‹</h1>

</section>
<section id="æ£€æµ‹éœ€æ±‚" class="slide level2">
<h2>æ£€æµ‹éœ€æ±‚</h2>
<ul>
<li>ç½‘ç»œæµé‡è®¡è´¹
<ul>
<li>é¿å…è®¡è´¹è¯¯å·®å’ŒæŸå¤±</li>
</ul></li>
<li>ç½‘ç»œå®‰å…¨å®¡è®¡
<ul>
<li>æ‰“å‡»ç½‘ç»œæ”»å‡»æºå¤´</li>
</ul></li>
<li>ç½‘ç»œæ»¥ç”¨
<ul>
<li>æ‰“å‡»ç½‘ç»œæ»¥ç”¨æºå¤´</li>
</ul></li>
</ul>
</section>
<section id="æ£€æµ‹æ‰‹æ®µ" class="slide level2">
<h2>æ£€æµ‹æ‰‹æ®µ</h2>
<ul>
<li>é™æ€ç‰¹å¾
<ul>
<li>åè®®å…³é”®å­—</li>
</ul></li>
<li>åŠ¨æ€ç‰¹å¾
<ul>
<li>æµé‡ç»Ÿè®¡ç‰¹å¾</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<h3 id="é™æ€ç‰¹å¾æ£€æµ‹">é™æ€ç‰¹å¾æ£€æµ‹</h3>
<ul>
<li>ç«¯å£æ‰«æ</li>
<li>åè®®å­—æ®µå˜é‡ç‰¹å¾
<ul>
<li>ç½‘ç»œæ•°æ®æŠ¥æ–‡
<ul>
<li>å¤´éƒ¨å­—æ®µ</li>
<li>è´Ÿè½½æ•°æ®</li>
</ul></li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<h3 id="ç«¯å£æ‰«ææ£€æµ‹æ–¹å¼">ç«¯å£æ‰«ææ£€æµ‹æ–¹å¼</h3>
<ul>
<li>ç«¯å£æ‰«ææ–¹å¼ä¸»è¦é€‚ç”¨äºå¯¹ä»£ç†æœåŠ¡å™¨çš„æ£€æµ‹</li>
<li>ä»£ç†æœåŠ¡å™¨ä¸€èˆ¬æœ€ä¸ºå¸¸ç”¨çš„ç«¯å£æœ‰8080/3218ç­‰ï¼Œå¯ä»¥é€šè¿‡æ‰«æè¿™äº›ç«¯å£è·å¾—</li>
<li>å¯¹äºé‡‡ç”¨éå¸¸ç”¨ç«¯å£çš„ä»£ç†æœåŠ¡å™¨ï¼Œç«¯å£æ‰«ææ–¹å¼çš„æ•ˆç‡ä½ï¼Œå‡†ç¡®æ€§ä¹Ÿå·®</li>
</ul>
</section>
<section class="slide level2">

<h3 id="å˜é‡ç‰¹å¾">å˜é‡ç‰¹å¾</h3>
<ul>
<li>HTTP ä»£ç†å¸¸è§çš„å˜é‡ç‰¹å¾ï¼š
<ul>
<li>VIA</li>
<li>X-FORWARDED-FOR</li>
<li>CACHE-CONTROL</li>
<li>FORWAREDED</li>
<li>PROXY-CONNECTION</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<h3 id="åŠ¨æ€ç‰¹å¾">åŠ¨æ€ç‰¹å¾</h3>
<ul>
<li>åè®®è¡Œä¸ºç‰¹å¾ï¼ˆç…§æ¬ã€Œå¯¹åŒ¿åé€šä¿¡ç³»ç»Ÿã€çš„æ”»å‡»ï¼‰
<ul>
<li>æµé‡å½¢çŠ¶æ”»å‡»
<ul>
<li>é€šä¿¡æ¨¡å¼æ”»å‡»</li>
<li>æ¶ˆæ¯é¢‘åº¦æ”»å‡»</li>
<li>æŠ¥æ–‡è®¡æ•°æ”»å‡»</li>
</ul></li>
<li>äº¤é›†æ”»å‡»</li>
<li>é‡æ”¾æ”»å‡»</li>
<li>åˆ·æ–°æ”»å‡»</li>
<li>æ—¶é—´æ”»å‡»</li>
</ul></li>
</ul>
</section>
<section id="ä»£ç†æœåŠ¡æ£€æµ‹" class="slide level2">
<h2>ä»£ç†æœåŠ¡æ£€æµ‹</h2>
<ul>
<li>è®¾ç½®æµè§ˆå™¨ä½¿ç”¨HTTPä»£ç†</li>
<li>ä¼ªé€ HTTPè¯·æ±‚å¤´
<ul>
<li>X-Forwarded-For è®¾ç½®å•ä¸ªã€å¤šä¸ªIPåœ°å€</li>
<li>X-Forwarded-For è®¾ç½®ä»»æ„å­—ç¬¦</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<figure>
<img data-src="images/chap0x03/browser-fingerprinting.png" alt="" /><figcaption>é¡ºç€ç½‘çº¿æ‰¾åˆ°ä½ </figcaption>
</figure>
</section>
<section class="slide level2">

<p><img data-src="images/chap0x03/tor-detection.png" /></p>
<ul>
<li>ä»£ç†æ£€æµ‹æ–¹æ³•çš„æ•ˆæœå–å†³äºæ£€æµ‹æ–¹æ‰€æ‹¥æœ‰çš„èµ„æºå¤šå°‘ã€æƒé™å¤§å°
<ul>
<li>ä¸»æœºã€äº¤æ¢æœºã€è·¯ç”±å™¨ã€æ ¸å¿ƒç½‘äº¤æ¢æœºã€ISPè·¯ç”±å™¨ã€‚ã€‚ã€‚</li>
<li>ä¸»æœºç›‘æ§è½¯ä»¶ã€ç½‘ç»œå—…æ¢ã€ç½‘ç»œç¯¡æ”¹ã€‚ã€‚ã€‚</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<figure>
<img data-src="images/chap0x03/cyber-security-internals.png" alt="" /><figcaption>æ— å¯¹æŠ—ä¸å®‰å…¨</figcaption>
</figure>
</section>
</section>
<section>
<section id="è¯¾åæ€è€ƒé¢˜" class="title-slide slide level1">
<h1>è¯¾åæ€è€ƒé¢˜</h1>

</section>
<section class="slide level2">

<ul>
<li>ä»£ç†æŠ€æœ¯åœ¨ç½‘ç»œæ”»é˜²ä¸­çš„æ„ä¹‰ï¼Ÿ
<ul>
<li>å¯¹æ”»æ–¹çš„æ„ä¹‰ï¼Ÿ</li>
<li>å¯¹å®ˆæ–¹çš„æ„ä¹‰ï¼Ÿ</li>
</ul></li>
<li>å¸¸è§„ä»£ç†æŠ€æœ¯å’Œé«˜çº§ä»£ç†æŠ€æœ¯çš„è®¾è®¡æ€æƒ³åŒºåˆ«ä¸è”ç³»ï¼Ÿ</li>
</ul>
</section>
</section>
    </div>
  </div>

  <script src="lib/reveal.js/lib/js/head.min.js"></script>
  <script src="lib/reveal.js/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Display the page number of the current slide
        slideNumber: true,
        // Push each slide change to the browser history
        history: true,
        // Transition style
        transition: 'fade', // none/fade/slide/convex/concave/zoom
        math: {
          mathjax: '',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },
  multiplex: {
    secret: , //ã€TO REPLACEã€‘ null so the clients do not have control of the master presentation
    id: '', // ã€TO REPLACEã€‘socketId, obtained from socket.io server
    url: ''  //ã€TO REPLACEã€‘Location of your socket.io server
  },

menu: {
		// Specifies which side of the presentation the menu will 
		// be shown. Use 'left' or 'right'.
		side: 'left',

		// Specifies the width of the menu.
		// Can be one of the following:
		// 'normal', 'wide', 'third', 'half', 'full', or
		// any valid css length value
		width: 'normal',

		// Add slide numbers to the titles in the slide list.
		// Use 'true' or format string (same as reveal.js slide numbers)
		numbers: true,

		// Specifies which slide elements will be used for generating
		// the slide titles in the menu. The default selects the first
		// heading element found in the slide, but you can specify any
		// valid css selector and the text from the first matching
		// element will be used.
		// Note: that a section data-menu-title attribute or an element
		// with a menu-title class will take precedence over this option
		titleSelector: 'h1, h2, h3, h4, h5, h6',

		// If slides do not have a matching title, attempt to use the
		// start of the text content as the title instead
		useTextContentForMissingTitles: false,

		// Hide slides from the menu that do not have a title.
		// Set to 'true' to only list slides with titles.
		hideMissingTitles: false,

		// Adds markers to the slide titles to indicate the 
		// progress through the presentation. Set to 'false'
		// to hide the markers.
		markers: true,

		// Specify custom panels to be included in the menu, by
		// providing an array of objects with 'title', 'icon'
		// properties, and either a 'src' or 'content' property.
		custom: false,

		// Specifies the themes that will be available in the themes
		// menu panel. Set to 'true' to show the themes menu panel
		// with the default themes list. Alternatively, provide an
		// array to specify the themes to make available in the
		// themes menu panel, for example...
		// [
		//     { name: 'Black', theme: 'css/theme/black.css' },
		//     { name: 'White', theme: 'css/theme/white.css' },
		//     { name: 'League', theme: 'css/theme/league.css' }
		// ]
		themes: false,

		// Specifies the path to the default theme files. If your
		// presentation uses a different path to the standard reveal
		// layout then you need to provide this option, but only
		// when 'themes' is set to 'true'. If you provide your own 
		// list of themes or 'themes' is set to 'false' the 
		// 'themesPath' option is ignored.
		themesPath: 'css/theme/',

		// Specifies if the transitions menu panel will be shown.
		// Set to 'true' to show the transitions menu panel with
		// the default transitions list. Alternatively, provide an
		// array to specify the transitions to make available in
		// the transitions panel, for example...
		// ['None', 'Fade', 'Slide']
		transitions: false,

		// Adds a menu button to the slides to open the menu panel.
		// Set to 'false' to hide the button.
		openButton: true,

		// If 'true' allows the slide number in the presentation to
		// open the menu panel. The reveal.js slideNumber option must 
		// be displayed for this to take effect
		openSlideNumber: false,

		// If true allows the user to open and navigate the menu using
		// the keyboard. Standard keyboard interaction with reveal
		// will be disabled while the menu is open.
		keyboard: true,

		// Normally the menu will close on user actions such as
		// selecting a menu item, or clicking the presentation area.
		// If 'true', the sticky option will leave the menu open
		// until it is explicitly closed, that is, using the close
		// button or pressing the ESC or m key (when the keyboard 
		// interaction option is enabled).
		sticky: false,

		// If 'true' standard menu items will be automatically opened
		// when navigating using the keyboard. Note: this only takes 
		// effect when both the 'keyboard' and 'sticky' options are enabled.
		autoOpen: true,

		// If 'true' the menu will not be created until it is explicitly
		// requested by calling RevealMenu.init(). Note this will delay
		// the creation of all menu panels, including custom panels, and
		// the menu button.
		delayInit: false,

		// If 'true' the menu will be shown when the menu is initialised.
		openOnInit: false,

		// By default the menu will load it's own font-awesome library
		// icons. If your presentation needs to load a different
		// font-awesome library the 'loadIcons' option can be set to false
		// and the menu will not attempt to load the font-awesome library.
		loadIcons: true
	},


        // Optional reveal.js plugins
        dependencies: [
          { src: 'lib/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'lib/reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: 'lib/reveal.js/plugin/math/math.js', async: true },
          { src: 'lib/reveal.js/plugin/menu/menu.js'},
          { src: 'lib/reveal.js/plugin/markdown/marked.js'},
          { src: 'lib/reveal.js/plugin/markdown/markdown.js'},
          { src: 'lib/reveal.js/plugin/search/search.js'},
          { src: 'lib/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'lib/reveal.js/plugin/notes/notes.js', async: true },
          { src: 'lib/reveal.js/plugin/socket.io/socket.io.js', async: true },
          { src: 'lib/reveal.js/plugin/multiplex/master.js', async: true },
          { src: 'lib/reveal.js/plugin/multiplex/client.js', async: true },
        ]
      });
    </script>
    </body>
</html>
